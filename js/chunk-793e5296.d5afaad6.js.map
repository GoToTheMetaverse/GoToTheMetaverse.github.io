{"version":3,"sources":["webpack:///./src/views/PicEdit.vue","webpack:///./src/views/PicEdit.vue?ab1f","webpack:///./node_modules/core-js/modules/es.array.join.js","webpack:///./node_modules/core-js/internals/array-method-is-strict.js"],"names":["class","src","alt","$router","back","isEditingPicName","picName","length","onEditName","inputPicName","onEditPicNameConfirm","onEditPicNameCancel","errorMessage","ref","width","frameWidth","height","frameHeight","scrolling","frameborder","data","picUid","loadingPic","loadingSuccess","loadingEditPicName","iframeWin","mounted","$refs","myiframe","contentWindow","parseInt","$route","params","window","addEventListener","procMessage","methods","tilesToText","tiles","arr","i","t","toString","push","join","event","undefined","cmd","indexOf","recv","$store","wait","reqWeb","api","loginToken","localStorage","getItem","userUid","getters","callAsync","res","code","message","picture","pic_name","pic_data","c","postMessage","w","h","console","log","colors","picTileText","commit","error","reqData","newPicName","loadingEditName","errorEditName","rid","this","render","$","IndexedObject","toIndexedObject","arrayMethodIsStrict","nativeJoin","ES3_STRINGS","Object","STRICT_METHOD","target","proto","forced","separator","call","fails","module","exports","METHOD_NAME","argument","method"],"mappings":"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","file":"js/chunk-793e5296.d5afaad6.js","sourcesContent":["<template>\n  <div class=\"tw-rounded bg-white\">\n    <div class=\"flex justify-center\">\n      <div class=\"w-full py-2 md:px-5\">\n        <div class=\"flex justify-between items-center px-3 md:p-0\">\n          <button class=\"w-6 h-6 mr-2\" @click=\"$router.back()\">\n            <img src=\"/images/hero-back.svg\" alt=\"back\" />\n          </button>\n          <div v-if=\"!isEditingPicName\" class=\"mx-2 text-2xl\">\n            {{ picName }}\n          </div>\n          <button\n            v-if=\"!isEditingPicName && picName.length > 0\"\n            class=\"px-2 mx-2\"\n            @click=\"onEditName()\"\n          >\n            <img class=\"w-6 h-6\" src=\"/images/hero-edit.svg\" />\n          </button>\n          <input\n            class=\"rounded-lg border-2 border-black px-2\"\n            v-if=\"isEditingPicName\"\n            v-model=\"inputPicName\"\n          />\n          <div v-if=\"isEditingPicName\">\n            <button @click=\"onEditPicNameConfirm()\" class=\"ml-2\">\n              <img class=\"w-8 h-8\" src=\"/images/hero-confirm-outline.svg\" />\n            </button>\n            <button @click=\"onEditPicNameCancel()\" class=\"ml-2\">\n              <img class=\"w-8 h-8\" src=\"/images/hero-x-outline.svg\" />\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <div v-if=\"errorMessage.length > 0\" class=\"text-red-600 pb-2\">\n      {{ errorMessage }}\n    </div>\n\n    <div class=\"pb-0 md:pb-5 px-0 md:px-5\">\n      <div class=\"flex justify-center item-start\">\n        <iframe\n          class=\"tw-rounded overflow-hidden\"\n          ref=\"myiframe\"\n          src=\"/kbEditPic/main.html\"\n          :width=\"frameWidth\"\n          :height=\"frameHeight\"\n          scrolling=\"no\"\n          frameborder=\"0\"\n        >\n        </iframe>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      picUid: 0,\n      picName: \"\",\n      loadingPic: false,\n      loadingSuccess: false,\n      errorMessage: \"\",\n      frameWidth: \"100%\",\n      frameHeight: \"100%\",\n\n      isEditingPicName: false,\n      inputPicName: \"\",\n      loadingEditPicName: false,\n\n      iframeWin: null,\n    };\n  },\n  async mounted() {\n    this.iframeWin = this.$refs.myiframe.contentWindow;\n\n    this.picUid = parseInt(this.$route.params.picUid, 10);\n    // console.log(\"PicEdit\", [this.picUid, this.$store.getters.userUid]);\n\n    window.addEventListener(\"message\", this.procMessage);\n  },\n  methods: {\n    tilesToText(tiles) {\n      const arr = [];\n      for (let i = 0; i < tiles.length; i++) {\n        const t = tiles[i].toString(16);\n        arr.push(t == 0 ? \" \" : t);\n      }\n      return arr.join(\"\");\n    },\n    async procMessage(event) {\n      if (event.data.cmd === undefined) return;\n      if (event.data.cmd.indexOf(\"kbEditPic\") < 0) return;\n\n      const recv = event.data;\n      // console.log(\"EditPic recv message\", recv);\n\n      if (recv.cmd == \"kbEditPic.loadingComplete\") {\n        await this.$store.wait(1000);\n\n        const reqWeb = {\n          api: \"getPicture\",\n          loginToken: localStorage.getItem(\"loginToken\"),\n          userUid: this.$store.getters.userUid,\n          picUid: this.picUid,\n        };\n\n        const res = await this.$store.callAsync(reqWeb);\n        if (res.code != 100) {\n          this.errorMessage = res.message;\n          return;\n        }\n\n        // console.log(\"getPicture res\", res);\n        this.picName = res.picture.pic_name;\n        // console.log(\"name\", this.picName, res.picture);\n\n        const arr = [];\n        for (let i = 0; i < 16 * 16; i++) {\n          arr.push(0);\n        }\n        for (let i = 0; i < res.picture.pic_data.length; i++) {\n          const c = res.picture.pic_data[i];\n\n          if (c == \" \") {\n            arr[i] = 0;\n          } else {\n            arr[i] = parseInt(c, 16);\n          }\n        }\n\n        this.$store.postMessage(this.iframeWin, {\n          cmd: \"kbEditPic.firstData\",\n          tiles: arr,\n        });\n      } else if (recv.cmd == \"kbEditPic.frameSize\") {\n        this.frameWidth = recv.w;\n        this.frameHeight = recv.h;\n      } else if (recv.cmd == \"kbEditPic.save\") {\n        console.log(\"try save\");\n        const reqWeb = {\n          api: \"savePicture\",\n          loginToken: localStorage.getItem(\"loginToken\"),\n          userUid: this.$store.getters.userUid,\n          picUid: this.picUid,\n          colors: recv.colors,\n          picTileText: this.tilesToText(recv.tiles),\n        };\n\n        const res = await this.$store.callAsync(reqWeb);\n        if (res.code != 100) {\n          this.errorMessage = res.message;\n          return;\n        }\n\n        this.$store.commit(\"updatePicture\", res.picture);\n        this.$store.postMessage(this.iframeWin, {\n          cmd: \"kbEditPic.saveComplete\",\n        });\n      } else {\n        console.error(\"EditPic unknown cmd\", recv.cmd);\n      }\n    },\n    async onEditName() {\n      this.isEditingPicName = true;\n      this.inputPicName = this.picName;\n    },\n    async onEditPicNameConfirm() {\n      const reqData = {\n        api: \"updatePictureName\",\n        loginToken: localStorage.getItem(\"loginToken\"),\n        userUid: this.$store.getters.userUid,\n        picUid: this.picUid,\n        newPicName: this.inputPicName,\n      };\n      console.log(\"onEditPicNameConfirm\", reqData);\n\n      this.errorMessage = \"\";\n      this.loadingEditName = true;\n      const res = await this.$store.callAsync(reqData);\n      this.loadingEditName = false;\n\n      if (res.code != 100) {\n        this.errorEditName = res.message;\n        return;\n      }\n\n      console.log(\"onEditPicNameConfirm res\", res);\n\n      this.$store.commit(\"updatePicture\", {\n        rid: this.picUid,\n        pic_name: res.newPicName,\n      });\n      this.picName = res.newPicName;\n      this.isEditingPicName = false;\n    },\n    onEditPicNameCancel() {\n      this.isEditingPicName = false;\n    },\n  },\n};\n</script>\n","import { render } from \"./PicEdit.vue?vue&type=template&id=58eb22a0\"\nimport script from \"./PicEdit.vue?vue&type=script&lang=js\"\nexport * from \"./PicEdit.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script","'use strict';\nvar $ = require('../internals/export');\nvar IndexedObject = require('../internals/indexed-object');\nvar toIndexedObject = require('../internals/to-indexed-object');\nvar arrayMethodIsStrict = require('../internals/array-method-is-strict');\n\nvar nativeJoin = [].join;\n\nvar ES3_STRINGS = IndexedObject != Object;\nvar STRICT_METHOD = arrayMethodIsStrict('join', ',');\n\n// `Array.prototype.join` method\n// https://tc39.es/ecma262/#sec-array.prototype.join\n$({ target: 'Array', proto: true, forced: ES3_STRINGS || !STRICT_METHOD }, {\n  join: function join(separator) {\n    return nativeJoin.call(toIndexedObject(this), separator === undefined ? ',' : separator);\n  }\n});\n","'use strict';\nvar fails = require('../internals/fails');\n\nmodule.exports = function (METHOD_NAME, argument) {\n  var method = [][METHOD_NAME];\n  return !!method && fails(function () {\n    // eslint-disable-next-line no-useless-call,no-throw-literal -- required for testing\n    method.call(null, argument || function () { throw 1; }, 1);\n  });\n};\n"],"sourceRoot":""}