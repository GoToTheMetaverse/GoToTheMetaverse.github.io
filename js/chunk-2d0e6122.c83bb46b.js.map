{"version":3,"sources":["webpack:///./src/views/PicEdit.vue","webpack:///./src/views/PicEdit.vue?ab1f"],"names":["class","src","alt","$router","back","isEditingPicName","picName","length","onEditName","inputPicName","onEditPicNameConfirm","onEditPicNameCancel","errorMessage","ref","width","frameWidth","height","frameHeight","scrolling","frameborder","data","picUid","loadingPic","loadingSuccess","loadingEditPicName","iframeWin","mounted","$refs","myiframe","contentWindow","parseInt","$route","params","window","addEventListener","procMessage","unmounted","removeEventListener","this","methods","tilesToText","tiles","arr","i","t","toString","push","join","event","undefined","cmd","indexOf","recv","$store","wait","reqWeb","api","loginToken","localStorage","getItem","userUid","getters","callAsync","res","code","message","picture","pic_name","pic_data","c","postMessage","w","h","console","log","colors","picTileText","sendData","commit","error","reqData","newPicName","loadingEditName","errorEditName","rid","render"],"mappings":"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","file":"js/chunk-2d0e6122.c83bb46b.js","sourcesContent":["<template>\n  <div class=\"tw-rounded bg-white\">\n    <div class=\"flex justify-center\">\n      <div class=\"w-full py-2 md:px-5\">\n        <div class=\"flex justify-between items-center px-3 md:p-0\">\n          <button class=\"w-6 h-6 mr-2\" @click=\"$router.back()\">\n            <img src=\"/images/hero-back.svg\" alt=\"back\" />\n          </button>\n          <div v-if=\"!isEditingPicName\" class=\"mx-2 text-2xl\">\n            {{ picName }}\n          </div>\n          <button\n            v-if=\"!isEditingPicName && picName.length > 0\"\n            class=\"px-2 mx-2\"\n            @click=\"onEditName()\"\n          >\n            <img class=\"w-6 h-6\" src=\"/images/hero-edit.svg\" />\n          </button>\n          <input\n            class=\"rounded-lg border-2 border-black px-2\"\n            v-if=\"isEditingPicName\"\n            v-model=\"inputPicName\"\n          />\n          <div v-if=\"isEditingPicName\">\n            <button @click=\"onEditPicNameConfirm()\" class=\"ml-2\">\n              <img class=\"w-8 h-8\" src=\"/images/hero-confirm-outline.svg\" />\n            </button>\n            <button @click=\"onEditPicNameCancel()\" class=\"ml-2\">\n              <img class=\"w-8 h-8\" src=\"/images/hero-x-outline.svg\" />\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <div v-if=\"errorMessage.length > 0\" class=\"text-red-600 pb-2\">\n      {{ errorMessage }}\n    </div>\n\n    <div class=\"pb-0 md:pb-5 px-0 md:px-5\">\n      <div class=\"flex justify-center item-start\">\n        <iframe\n          class=\"tw-iframe\"\n          ref=\"myiframe\"\n          src=\"/kbEditPic/main.html\"\n          :width=\"frameWidth\"\n          :height=\"frameHeight\"\n          scrolling=\"no\"\n          frameborder=\"0\"\n        >\n        </iframe>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      picUid: 0,\n      picName: \"\",\n      loadingPic: false,\n      loadingSuccess: false,\n      errorMessage: \"\",\n      frameWidth: \"100%\",\n      frameHeight: \"100%\",\n\n      isEditingPicName: false,\n      inputPicName: \"\",\n      loadingEditPicName: false,\n\n      iframeWin: null,\n    };\n  },\n  async mounted() {\n    // console.log(\"PicEdit mounted\");\n    this.iframeWin = this.$refs.myiframe.contentWindow;\n    this.picUid = parseInt(this.$route.params.picUid, 10);\n    window.addEventListener(\"message\", this.procMessage);\n  },\n  unmounted() {\n    // console.log(\"PicEdit unmounted\");\n    window.removeEventListener(\"message\", this.procMessage);\n  },\n  methods: {\n    tilesToText(tiles) {\n      const arr = [];\n      for (let i = 0; i < tiles.length; i++) {\n        const t = tiles[i].toString(16);\n        arr.push(t == 0 ? \" \" : t);\n      }\n      return arr.join(\"\");\n    },\n    async procMessage(event) {\n      if (event.data.cmd === undefined) return;\n      if (event.data.cmd.indexOf(\"kbEditPic\") < 0) return;\n\n      const recv = event.data;\n      // console.log(\"EditPic recv message\", recv);\n\n      if (recv.cmd == \"kbEditPic.loadingComplete\") {\n        await this.$store.wait(1000);\n\n        const reqWeb = {\n          api: \"getPicture\",\n          loginToken: localStorage.getItem(\"loginToken\"),\n          userUid: this.$store.getters.userUid,\n          picUid: this.picUid,\n        };\n\n        const res = await this.$store.callAsync(reqWeb);\n        if (res.code != 100) {\n          this.errorMessage = res.message;\n          return;\n        }\n\n        // console.log(\"getPicture res\", res);\n        this.picName = res.picture.pic_name;\n        // console.log(\"name\", this.picName, res.picture);\n\n        const arr = [];\n        for (let i = 0; i < 16 * 16; i++) {\n          arr.push(0);\n        }\n        for (let i = 0; i < res.picture.pic_data.length; i++) {\n          const c = res.picture.pic_data[i];\n\n          if (c == \" \") {\n            arr[i] = 0;\n          } else {\n            arr[i] = parseInt(c, 16);\n          }\n        }\n\n        this.$store.postMessage(this.iframeWin, {\n          cmd: \"kbEditPic.firstData\",\n          tiles: arr,\n        });\n      } else if (recv.cmd == \"kbEditPic.frameSize\") {\n        this.frameWidth = recv.w;\n        this.frameHeight = recv.h;\n      } else if (recv.cmd == \"kbEditPic.save\") {\n        console.log(\"savePicture try\");\n        await this.$store.wait(1000); // 연타방지\n\n        const reqWeb = {\n          api: \"savePicture\",\n          loginToken: localStorage.getItem(\"loginToken\"),\n          userUid: this.$store.getters.userUid,\n          picUid: this.picUid,\n          colors: recv.colors,\n          picTileText: this.tilesToText(recv.tiles),\n        };\n\n        const res = await this.$store.callAsync(reqWeb);\n        const sendData = { cmd: \"kbEditPic.saveComplete\" };\n        if (res.code == -5) {\n          //변경점 없음\n          console.log(\"savePicture skip\");\n        } else if (res.code != 100) {\n          console.log(\"savePicture ng\", res.message);\n          this.errorMessage = res.message;\n        } else {\n          console.log(\"savePicture ok\");\n          this.$store.commit(\"updatePicture\", res.picture);\n        }\n        this.$store.postMessage(this.iframeWin, sendData);\n      } else {\n        console.error(\"EditPic unknown cmd\", recv.cmd);\n      }\n    },\n    async onEditName() {\n      this.isEditingPicName = true;\n      this.inputPicName = this.picName;\n    },\n    async onEditPicNameConfirm() {\n      const reqData = {\n        api: \"updatePictureName\",\n        loginToken: localStorage.getItem(\"loginToken\"),\n        userUid: this.$store.getters.userUid,\n        picUid: this.picUid,\n        newPicName: this.inputPicName,\n      };\n      console.log(\"onEditPicNameConfirm\", reqData);\n\n      this.errorMessage = \"\";\n      this.loadingEditName = true;\n      const res = await this.$store.callAsync(reqData);\n      this.loadingEditName = false;\n\n      if (res.code != 100) {\n        this.errorEditName = res.message;\n        return;\n      }\n\n      console.log(\"onEditPicNameConfirm res\", res);\n\n      this.$store.commit(\"updatePicture\", {\n        rid: this.picUid,\n        pic_name: res.newPicName,\n      });\n      this.picName = res.newPicName;\n      this.isEditingPicName = false;\n    },\n    onEditPicNameCancel() {\n      this.isEditingPicName = false;\n    },\n  },\n};\n</script>\n","import { render } from \"./PicEdit.vue?vue&type=template&id=7b09ce19\"\nimport script from \"./PicEdit.vue?vue&type=script&lang=js\"\nexport * from \"./PicEdit.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script"],"sourceRoot":""}