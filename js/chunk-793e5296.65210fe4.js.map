{"version":3,"sources":["webpack:///./src/views/PicEdit.vue","webpack:///./src/views/PicEdit.vue?ab1f","webpack:///./node_modules/core-js/modules/es.array.join.js","webpack:///./node_modules/core-js/internals/array-method-is-strict.js"],"names":["class","ref","src","width","height","scrolling","frameborder","errorMessage","data","loadingPic","loadingSuccess","mounted","tilesToText","tiles","arr","i","length","t","toString","push","join","store","$store","iframeWin","$refs","myiframe","contentWindow","loginToken","localStorage","getItem","userUid","getters","picUid","$route","params","console","log","window","addEventListener","event","undefined","cmd","recv","wait","reqWeb","api","callAsync","res","code","message","picture","pic_data","c","parseInt","postMessage","colors","picTileText","commit","error","render","$","IndexedObject","toIndexedObject","arrayMethodIsStrict","nativeJoin","ES3_STRINGS","Object","STRICT_METHOD","target","proto","forced","separator","call","this","fails","module","exports","METHOD_NAME","argument","method"],"mappings":"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","file":"js/chunk-793e5296.65210fe4.js","sourcesContent":["<template>\n  <div class=\"w-full rounded-lg bg-white p-2\">\n    <div class=\"justify-center w-full\">\n      <div class=\"flex justify-center\">EDIT PIC</div>\n      <div class=\"flex justify-center\">\n        <div class=\"text-red-600\">{{ errorMessage }}</div>\n        <div class=\"w-96 h-96\">\n          <iframe\n            ref=\"myiframe\"\n            src=\"/kbEditPic/main.html\"\n            width=\"100%\"\n            height=\"100%\"\n            scrolling=\"no\"\n            frameborder=\"0\"\n          >\n          </iframe>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      loadingPic: false,\n      loadingSuccess: false,\n      errorMessage: \"\",\n    };\n  },\n  async mounted() {\n    const tilesToText = function (tiles) {\n      const arr = [];\n      for (let i = 0; i < tiles.length; i++) {\n        const t = tiles[i].toString(16);\n        arr.push(t == 0 ? \" \" : t);\n      }\n      return arr.join(\"\");\n    };\n\n    let store = this.$store;\n    let iframeWin = this.$refs.myiframe.contentWindow;\n    let loginToken = localStorage.getItem(\"loginToken\");\n    let userUid = store.getters.userUid;\n\n    const picUid = this.$route.params.picUid;\n    console.log(\"PicEdit\", picUid, store.getters.userUid);\n\n    window.addEventListener(\"message\", async (event) => {\n      if (event.data.cmd === undefined) return;\n      const recv = event.data;\n      // console.log(\"EditPic recv message\", recv);\n\n      if (recv.cmd == \"kbEditPic.loadingComplete\") {\n        await store.wait(1000);\n\n        const reqWeb = {\n          api: \"getPicture\",\n          loginToken,\n          userUid,\n          picUid,\n        };\n\n        const res = await store.callAsync(reqWeb);\n        if (res.code != 100) {\n          this.errorMessage = res.message;\n          return;\n        }\n\n        console.log(\"getPicture res\", res);\n\n        const arr = [];\n        for (let i = 0; i < res.picture.pic_data.length; i++) {\n          const c = res.picture.pic_data[i];\n          if (c == \" \") {\n            arr.push(0);\n          } else {\n            arr.push(parseInt(c, 16));\n          }\n        }\n\n        iframeWin.postMessage(\n          {\n            cmd: \"kbEditPic.firstData\",\n            tiles: arr,\n          },\n          \"*\"\n        );\n      } else if (recv.cmd == \"kbEditPic.save\") {\n        const reqWeb = {\n          api: \"savePicture\",\n          loginToken,\n          userUid,\n          picUid,\n          colors: recv.colors,\n          picTileText: tilesToText(recv.tiles),\n        };\n\n        const res = await store.callAsync(reqWeb);\n        if (res.code != 100) {\n          this.errorMessage = res.message;\n          return;\n        }\n\n        this.$store.commit(\"updatePicture\", res.picture);\n\n        iframeWin.postMessage(\n          {\n            cmd: \"kbEditPic.saveComplete\",\n          },\n          \"*\"\n        );\n      } else {\n        console.error(\"EditPci unknown cmd\", recv.cmd);\n      }\n    });\n  },\n};\n</script>\n","import { render } from \"./PicEdit.vue?vue&type=template&id=4015a079\"\nimport script from \"./PicEdit.vue?vue&type=script&lang=js\"\nexport * from \"./PicEdit.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script","'use strict';\nvar $ = require('../internals/export');\nvar IndexedObject = require('../internals/indexed-object');\nvar toIndexedObject = require('../internals/to-indexed-object');\nvar arrayMethodIsStrict = require('../internals/array-method-is-strict');\n\nvar nativeJoin = [].join;\n\nvar ES3_STRINGS = IndexedObject != Object;\nvar STRICT_METHOD = arrayMethodIsStrict('join', ',');\n\n// `Array.prototype.join` method\n// https://tc39.es/ecma262/#sec-array.prototype.join\n$({ target: 'Array', proto: true, forced: ES3_STRINGS || !STRICT_METHOD }, {\n  join: function join(separator) {\n    return nativeJoin.call(toIndexedObject(this), separator === undefined ? ',' : separator);\n  }\n});\n","'use strict';\nvar fails = require('../internals/fails');\n\nmodule.exports = function (METHOD_NAME, argument) {\n  var method = [][METHOD_NAME];\n  return !!method && fails(function () {\n    // eslint-disable-next-line no-useless-call,no-throw-literal -- required for testing\n    method.call(null, argument || function () { throw 1; }, 1);\n  });\n};\n"],"sourceRoot":""}