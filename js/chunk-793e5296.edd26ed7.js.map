{"version":3,"sources":["webpack:///./src/views/PicEdit.vue","webpack:///./src/views/PicEdit.vue?ab1f","webpack:///./node_modules/core-js/modules/es.array.join.js","webpack:///./node_modules/core-js/internals/array-method-is-strict.js"],"names":["class","src","alt","$router","back","isEditingPicName","picName","length","onEditName","inputPicName","onEditPicNameConfirm","onEditPicNameCancel","errorMessage","ref","width","frameWidth","height","frameHeight","scrolling","frameborder","data","picUid","loadingPic","loadingSuccess","loadingEditPicName","mounted","tilesToText","tiles","arr","i","t","toString","push","join","store","$store","iframeWin","$refs","myiframe","contentWindow","loginToken","localStorage","getItem","userUid","getters","parseInt","$route","params","console","log","window","addEventListener","event","undefined","cmd","recv","wait","reqWeb","api","callAsync","res","code","message","picture","pic_name","pic_data","c","postMessage","w","h","colors","picTileText","commit","error","methods","reqData","newPicName","loadingEditName","errorEditName","rid","this","render","$","IndexedObject","toIndexedObject","arrayMethodIsStrict","nativeJoin","ES3_STRINGS","Object","STRICT_METHOD","target","proto","forced","separator","call","fails","module","exports","METHOD_NAME","argument","method"],"mappings":"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","file":"js/chunk-793e5296.edd26ed7.js","sourcesContent":["<template>\n  <div class=\"flex justify-center rounded-lg bg-white p-2\">\n    <div class=\"justify-center w-96\">\n      <div class=\"flex justify-between my-2\">\n        <button class=\"w-8 h-8 mr-2\" @click=\"$router.back()\">\n          <img src=\"/images/hero-back.svg\" alt=\"back\" />\n        </button>\n        <div v-if=\"!isEditingPicName\" class=\"mx-2 text-2xl\">{{ picName }}</div>\n        <button\n          v-if=\"!isEditingPicName && picName.length > 0\"\n          class=\"px-2 mx-2\"\n          @click=\"onEditName()\"\n        >\n          <img class=\"w-6 h-6\" src=\"/images/hero-edit.svg\" />\n        </button>\n        <input\n          class=\"rounded-lg border-2 border-black px-2\"\n          v-if=\"isEditingPicName\"\n          v-model=\"inputPicName\"\n        />\n        <div v-if=\"isEditingPicName\">\n          <button @click=\"onEditPicNameConfirm()\" class=\"ml-2\">\n            <img class=\"w-8 h-8\" src=\"/images/hero-confirm-outline.svg\" />\n          </button>\n          <button @click=\"onEditPicNameCancel()\" class=\"ml-2\">\n            <img class=\"w-8 h-8\" src=\"/images/hero-x-outline.svg\" />\n          </button>\n        </div>\n      </div>\n\n      <div class=\"flex justify-center\">\n        <div class=\"text-red-600\">{{ errorMessage }}</div>\n        <div class=\"w-96 h-96\">\n          <iframe\n            class=\"rounded-xl overflow-hidden\"\n            ref=\"myiframe\"\n            src=\"/kbEditPic/main.html\"\n            :width=\"frameWidth\"\n            :height=\"frameHeight\"\n            scrolling=\"no\"\n            frameborder=\"0\"\n          >\n          </iframe>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      picUid: 0,\n      picName: \"\",\n      loadingPic: false,\n      loadingSuccess: false,\n      errorMessage: \"\",\n      frameWidth: \"100%\",\n      frameHeight: \"100%\",\n\n      isEditingPicName: false,\n      inputPicName: \"\",\n      loadingEditPicName: false,\n    };\n  },\n  async mounted() {\n    const tilesToText = function (tiles) {\n      const arr = [];\n      for (let i = 0; i < tiles.length; i++) {\n        const t = tiles[i].toString(16);\n        arr.push(t == 0 ? \" \" : t);\n      }\n      return arr.join(\"\");\n    };\n\n    let store = this.$store;\n    let iframeWin = this.$refs.myiframe.contentWindow;\n    let loginToken = localStorage.getItem(\"loginToken\");\n    let userUid = store.getters.userUid;\n\n    const picUid = parseInt(this.$route.params.picUid, 10);\n    console.log(\"PicEdit\", [picUid, store.getters.userUid]);\n\n    window.addEventListener(\"message\", async (event) => {\n      if (event.data.cmd === undefined) return;\n      const recv = event.data;\n      // console.log(\"EditPic recv message\", recv);\n\n      if (recv.cmd == \"kbEditPic.loadingComplete\") {\n        await store.wait(1000);\n\n        const reqWeb = {\n          api: \"getPicture\",\n          loginToken,\n          userUid,\n          picUid,\n        };\n\n        const res = await store.callAsync(reqWeb);\n        if (res.code != 100) {\n          this.errorMessage = res.message;\n          return;\n        }\n\n        // console.log(\"getPicture res\", res);\n        this.picUid = picUid;\n        this.picName = res.picture.pic_name;\n        // console.log(\"name\", this.picName, res.picture);\n\n        const arr = [];\n        for (let i = 0; i < 16 * 16; i++) {\n          arr.push(0);\n        }\n        for (let i = 0; i < res.picture.pic_data.length; i++) {\n          const c = res.picture.pic_data[i];\n\n          if (c == \" \") {\n            arr[i] = 0;\n          } else {\n            arr[i] = parseInt(c, 16);\n          }\n        }\n\n        iframeWin.postMessage(\n          {\n            cmd: \"kbEditPic.firstData\",\n            tiles: arr,\n          },\n          \"*\"\n        );\n      } else if (recv.cmd == \"kbEditPic.frameSize\") {\n        this.frameWidth = recv.w;\n        this.frameHeight = recv.h;\n      } else if (recv.cmd == \"kbEditPic.save\") {\n        const reqWeb = {\n          api: \"savePicture\",\n          loginToken,\n          userUid,\n          picUid,\n          colors: recv.colors,\n          picTileText: tilesToText(recv.tiles),\n        };\n\n        const res = await store.callAsync(reqWeb);\n        if (res.code != 100) {\n          this.errorMessage = res.message;\n          return;\n        }\n\n        this.$store.commit(\"updatePicture\", res.picture);\n\n        iframeWin.postMessage(\n          {\n            cmd: \"kbEditPic.saveComplete\",\n          },\n          \"*\"\n        );\n      } else {\n        console.error(\"EditPic unknown cmd\", recv.cmd);\n      }\n    });\n  },\n  methods: {\n    async onEditName() {\n      this.isEditingPicName = true;\n      this.inputPicName = this.picName;\n    },\n    async onEditPicNameConfirm() {\n      const reqData = {\n        api: \"updatePictureName\",\n        loginToken: localStorage.getItem(\"loginToken\"),\n        userUid: this.$store.getters.userUid,\n        picUid: this.picUid,\n        newPicName: this.inputPicName,\n      };\n      console.log(\"onEditPicNameConfirm\", reqData);\n\n      this.errorMessage = \"\";\n      this.loadingEditName = true;\n      const res = await this.$store.callAsync(reqData);\n      this.loadingEditName = false;\n\n      if (res.code != 100) {\n        this.errorEditName = res.message;\n        return;\n      }\n\n      console.log(\"onEditPicNameConfirm res\", res);\n\n      this.$store.commit(\"updatePicture\", {\n        rid: this.picUid,\n        pic_name: res.newPicName,\n      });\n      this.picName = res.newPicName;\n      this.isEditingPicName = false;\n    },\n    onEditPicNameCancel() {\n      this.isEditingPicName = false;\n    },\n  },\n};\n</script>\n","import { render } from \"./PicEdit.vue?vue&type=template&id=342936c8\"\nimport script from \"./PicEdit.vue?vue&type=script&lang=js\"\nexport * from \"./PicEdit.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script","'use strict';\nvar $ = require('../internals/export');\nvar IndexedObject = require('../internals/indexed-object');\nvar toIndexedObject = require('../internals/to-indexed-object');\nvar arrayMethodIsStrict = require('../internals/array-method-is-strict');\n\nvar nativeJoin = [].join;\n\nvar ES3_STRINGS = IndexedObject != Object;\nvar STRICT_METHOD = arrayMethodIsStrict('join', ',');\n\n// `Array.prototype.join` method\n// https://tc39.es/ecma262/#sec-array.prototype.join\n$({ target: 'Array', proto: true, forced: ES3_STRINGS || !STRICT_METHOD }, {\n  join: function join(separator) {\n    return nativeJoin.call(toIndexedObject(this), separator === undefined ? ',' : separator);\n  }\n});\n","'use strict';\nvar fails = require('../internals/fails');\n\nmodule.exports = function (METHOD_NAME, argument) {\n  var method = [][METHOD_NAME];\n  return !!method && fails(function () {\n    // eslint-disable-next-line no-useless-call,no-throw-literal -- required for testing\n    method.call(null, argument || function () { throw 1; }, 1);\n  });\n};\n"],"sourceRoot":""}